<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA_Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width" , initial-scale="1.0">
  <title>SoSy Course Planner</title>
  <link rel="stylesheet" href="stylesheets/login.css">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet"
    integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
  <link rel="stylesheet" href="stylesheets/navbar.css">
  <link rel="stylesheet" href="stylesheets/main.css">
  <link href='https://unpkg.com/boxicons@2.1.4/css/boxicons.min.css' rel='stylesheet'>
</head>

<body>
  <navbar-component></navbar-component>
  <script src="../javascript/components/navbar.js"></script>
  
  <main class="d-flex justify-content-center align-items-center">
    <div class="wrapper">

      <form action="/users/login" method="post">


        <script>
          document.addEventListener('DOMContentLoaded', function () {
            // test 
            const urlParams = new URLSearchParams(window.location.search);
            const loginError = urlParams.get('error');
            // error handling
            if (loginError) {
              alert("Invalid username or password. Please try again!");
            }
          });
        </script>

        <script>
          document.addEventListener('DOMContentLoaded', function () {
            // test 
            const urlParams = new URLSearchParams(window.location.search);
            const successMessage = urlParams.get('success');
            const errorMessage = urlParams.get('error');
            // error handling 
            if (successMessage) {
              alert(decodeURIComponent(successMessage.replace(/\+/g, ' ')));
            }
            if (errorMessage) {
              alert(decodeURIComponent(errorMessage.replace(/\+/g, ' ')));
            }
          });
        </script>

        <h1>Login</h1>

        <div class="input-box">
          <input type="text" id="username" name="name" placeholder="Username@sfu.ca" pattern="^.+@sfu\.ca$"
            title="Username must end with @sfu.ca" required>
          <i class='bx bxs-user'></i>
        </div>

        <script>
          document.getElementById('username').addEventListener('input', function (e) {
            var username = e.target.value;
            var pattern = new RegExp(e.target.pattern);
            // test 
            if (pattern.test(username)) {
              // The username ends with @sfu.ca
              e.target.setCustomValidity('');
            } else {
              // error handling 
              // The username does not end with @sfu.ca
              e.target.setCustomValidity('Username must end with @sfu.ca');
            }
          });
        </script>

        <div class="input-box">
          <input type="password" id="password" name="password" placeholder="Password" required>
          <i class='bx bxs-show' onclick="togglePasswordVisibility('password',this)"></i>
        </div>


        <script>
          function togglePasswordVisibility(inputId, icon) {
            var input = document.getElementById(inputId);

            if (input.type === "password") {
              input.type = "text";
              icon.className = 'bx bxs-hide'; // Change to eye closed icon when password is visible
            } else {
              input.type = "password";
              icon.className = 'bx bxs-show'; // Change to eye open icon when password is hidden
            }
          }
        </script>
        <button type="submit" class="btn">Login</button>
        <div class="register-link">
          <p>Don't have an account?
            <a href="register.html">Register</a>
            <a href="https://my.sfu.ca/account/PasswordReset" target="_blank" onclick="confirmRedirect()"
              style="display: block; margin-top: 1em;">Forgot Password?</a>
          </p>

        </div>
        <script>
          function confirmRedirect() {
            alert("You will be redirected to an external website.")
          }
        </script>
      </form>
    </div>
  </main>
</body>

</html>