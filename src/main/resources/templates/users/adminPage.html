<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Page</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
    <link rel="stylesheet" href="../stylesheets/header.css">
    <link rel="stylesheet" href="../stylesheets/main.css">
</head>

<body>
  <header-component></header-component>
  <script src="../javascript/displayHeader.js"></script>

    <main class="container mt-4">
      <div>
        <span>This is page is authorized by admins</span>
      </div>

      <br><br>

      <h1>USERS</h1>
      <section class="container mt-4">
        <div class="d-flex flex-wrap m-2">
          <form th:each="user:${users}" action="/users/remove" method="get">
            <input class="m-2 col btn btn-secondary" id="userName" name="userName" type="submit" th:value="${user.name}">
          </form>
        </div>
      </section> 
    </main>
    <footer>
      <div class="container">
        <script th:src="@{/javascript/adminPage.js}" type="text/javascript"></script>
        <a href="#" class="btn bg-success" onclick="logout()">Log Out</a>
      </div>
    </footer>

    <script>
    function logout() {
      // Handle the response from the server
      fetch('/logout')
        // test 
        .then(response => {
          if (response.redirected) {
            window.location.href = response.url;
          }
        })
        // error handling 
        .catch(error => {
          console.error('Error during logout:', error);
        });
    }
    </script>
    
    
  </div>
</div>

<script>
  function logout() {
    // Assume the server sends back JSON now
    fetch('/logout')
      .then(response => response.json()) 
      // test 
      .then(data => {
        if (data.status === "logged_out") {
          alert("Successfully Logged Out");
          window.location.href = '/index.html';
          
        }
      })
      // error handling 
      .catch(error => {
        console.error('Error during logout:', error);
      });
  }
  </script>
</body>

</html>